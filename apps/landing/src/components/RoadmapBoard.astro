---
import { getCollection } from "astro:content"

const allItems = await getCollection("roadmap")
const sorted = [...allItems].sort((a, b) => a.data.order - b.data.order)

const statusGroups = [
	{
		key: "shipped" as const,
		label: "SHIPPED",
		dot: "bg-chart-2",
		text: "text-chart-2",
		pulse: "",
	},
	{
		key: "in-progress" as const,
		label: "IN PROGRESS",
		dot: "bg-chart-3",
		text: "text-chart-3",
		pulse: "animate-pulse-dot",
	},
	{
		key: "planned" as const,
		label: "PLANNED",
		dot: "bg-accent",
		text: "text-accent",
		pulse: "",
	},
	{
		key: "exploring" as const,
		label: "EXPLORING",
		dot: "bg-chart-4",
		text: "text-chart-4",
		pulse: "",
	},
]

const categoryStyles: Record<string, string> = {
	traces: "border-chart-1/30 bg-chart-1/5 text-chart-1",
	logs: "border-chart-2/30 bg-chart-2/5 text-chart-2",
	metrics: "border-chart-3/30 bg-chart-3/5 text-chart-3",
	alerting: "border-chart-5/30 bg-chart-5/5 text-chart-5",
	integrations: "border-accent/30 bg-accent/5 text-accent",
	platform: "border-chart-4/30 bg-chart-4/5 text-chart-4",
	ai: "border-chart-p50/30 bg-chart-p50/5 text-chart-p50",
}
---

<section class="py-16 md:py-24">
	<div class="mx-auto max-w-6xl px-6">

		<!-- Status summary bar â€” terminal window chrome -->
		<div class="border border-border mb-16">
			<div class="flex items-center gap-1.5 px-4 py-2 border-b border-border bg-bg-elevated">
				<div class="w-2 h-2 bg-fg/10"></div>
				<div class="w-2 h-2 bg-fg/10"></div>
				<div class="w-2 h-2 bg-fg/10"></div>
				<span class="text-[9px] text-fg-muted ml-2 tracking-wider">roadmap.status</span>
				<div class="flex-1"></div>
				<span class="text-[9px] text-fg-muted tracking-wider">{sorted.length} total</span>
			</div>
			<div class="grid grid-cols-2 md:grid-cols-4 gap-px bg-border">
				{statusGroups.map((group) => {
					const count = sorted.filter((i) => i.data.status === group.key).length
					return (
						<div class="bg-bg p-4 md:p-5">
							<div class="flex items-center gap-2.5 mb-1.5">
								<div class={`w-2 h-2 ${group.dot} ${group.pulse}`} />
								<span class="text-[9px] text-fg-muted uppercase tracking-wider">{group.label}</span>
							</div>
							<div class={`text-2xl font-bold ${group.text}`}>{count}</div>
						</div>
					)
				})}
			</div>
		</div>

		<!-- Timeline -->
		<div class="relative">
			<!-- Vertical connector line (desktop) -->
			<div class="absolute left-[5px] top-2 bottom-2 w-px bg-border hidden md:block" />

			{statusGroups.map((group) => {
				const items = sorted.filter((i) => i.data.status === group.key)
				if (items.length === 0) return null
				return (
					<div class="relative mb-14 last:mb-0 md:pl-10">
						{/* Dot on the timeline */}
						<div class="absolute left-0 top-[3px] hidden md:flex items-center justify-center">
							<div class={`w-[11px] h-[11px] ${group.dot} ${group.pulse} ring-4 ring-bg`} />
						</div>

						{/* Section header */}
						<div class="flex items-center gap-3 mb-5">
							<div class={`w-2 h-2 ${group.dot} ${group.pulse} md:hidden`} />
							<h2 class={`text-[11px] uppercase tracking-wider font-medium ${group.text}`}>
								{group.label}
							</h2>
							<div class="flex-1 border-t border-border" />
							<span class="text-[10px] text-fg-muted">{items.length} {items.length === 1 ? "item" : "items"}</span>
						</div>

						{/* Items grid */}
						<div class="grid grid-cols-1 md:grid-cols-2 gap-px bg-border border border-border">
							{items.map((item) => (
								<div class="bg-bg p-5 md:p-6">
									{/* Category + Quarter */}
									<div class="flex items-center justify-between mb-3">
										<span class={`text-[9px] uppercase tracking-wider px-2 py-0.5 border ${categoryStyles[item.data.category] || "border-border text-fg-muted"}`}>
											{item.data.category}
										</span>
										<span class="text-[9px] text-fg-muted">{item.data.quarter}</span>
									</div>

									{/* Title */}
									<h3 class="text-sm font-semibold text-fg mb-2">{item.data.title}</h3>

									{/* Description */}
									<p class="text-xs text-fg-muted leading-relaxed">{item.data.description}</p>

									{/* Shipped date */}
									{item.data.shipped_date && (
										<div class="mt-3 pt-3 border-t border-border flex items-center gap-2">
											<div class="w-1.5 h-1.5 bg-chart-2" />
											<span class="text-[9px] text-fg-muted">Shipped</span>
											<span class="text-[9px] text-chart-2">{item.data.shipped_date}</span>
										</div>
									)}
								</div>
							))}
						</div>
					</div>
				)
			})}
		</div>

	</div>
</section>
